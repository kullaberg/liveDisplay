(function(){var a;a=function(){function b(f,c){var g,d;this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",links:!0,mock:!1,useHttp:!1};if(typeof f=="object"){for(g in f){d=f[g],this.options[g]=d}}this.context=c!=null?c:this,this.unique=this._genKey()}return b.prototype.hasNext=function(){return typeof this.context.nextUrl=="string"&&this.context.nextUrl.length>0},b.prototype.next=function(){return this.hasNext()?this.run(this.context.nextUrl):!1},b.prototype.run=function(d){var f,e,c;if(typeof this.options.clientId!="string"&&typeof this.options.accessToken!="string"){throw new Error("Missing clientId or accessToken.")}if(typeof this.options.accessToken!="string"&&typeof this.options.clientId!="string"){throw new Error("Missing clientId or accessToken.")}return this.options.before!=null&&typeof this.options.before=="function"&&this.options.before.call(this),typeof document!="undefined"&&document!==null&&(c=document.createElement("script"),c.id="instafeed-fetcher",c.src=d||this._buildUrl(),f=document.getElementsByTagName("head"),f[0].appendChild(c),e="instafeedCache"+this.unique,window[e]=new b(this.options,this),window[e].unique=this.unique),!0},b.prototype.parse=function(al){var V,ad,Z,ah,X,ac,R,ap,ak,af,an,ai,ab,am,Q,ae,aj,I,ao,K,U,q,J,j,F,Y,ag,H,aa,B,G,aq,W;if(typeof al!="object"){if(this.options.error!=null&&typeof this.options.error=="function"){return this.options.error.call(this,"Invalid JSON data"),!1}throw new Error("Invalid JSON response")}if(al.meta.code!==200){if(this.options.error!=null&&typeof this.options.error=="function"){return this.options.error.call(this,al.meta.error_message),!1}throw new Error("Error from Instagram: "+al.meta.error_message)}if(al.data.length===0){if(this.options.error!=null&&typeof this.options.error=="function"){return this.options.error.call(this,"No images were returned from Instagram"),!1}throw new Error("No images were returned from Instagram")}this.options.success!=null&&typeof this.options.success=="function"&&this.options.success.call(this,al),this.context.nextUrl="",al.pagination!=null&&(this.context.nextUrl=al.pagination.next_url);if(this.options.sortBy!=="none"){this.options.sortBy==="random"?G=["","random"]:G=this.options.sortBy.split("-"),B=G[0]==="least"?!0:!1;switch(G[1]){case"random":al.data.sort(function(){return 0.5-Math.random()});break;case"recent":al.data=this._sortBy(al.data,"created_time",B);break;case"liked":al.data=this._sortBy(al.data,"likes.count",B);break;case"commented":al.data=this._sortBy(al.data,"comments.count",B);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}}if(typeof document!="undefined"&&document!==null&&this.options.mock===!1){ae=al.data,aa=parseInt(this.options.limit,10),this.options.limit!=null&&ae.length>aa&&(ae=ae.slice(0,aa)),R=document.createDocumentFragment(),this.options.filter!=null&&typeof this.options.filter=="function"&&(ae=this._filter(ae,this.options.filter));if(this.options.template!=null&&typeof this.options.template=="string"){ak="",am="",K="",W=document.createElement("div");for(an=0,F=ae.length;an<F;an++){ai=ae[an],ab=ai.images[this.options.resolution];if(typeof ab!="object"){throw ac="No image found for resolution: "+this.options.resolution+".",new Error(ac)}U=ab.width,I=ab.height,ao="square",U>I&&(ao="landscape"),U<I&&(ao="portrait"),Q=ab.url,af=window.location.protocol.indexOf("http")>=0,af&&!this.options.useHttp&&(Q=Q.replace(/https?:\/\//,"//")),am=this._makeTemplate(this.options.template,{model:ai,id:ai.id,link:ai.link,type:ai.type,image:Q,width:U,height:I,orientation:ao,caption:this._getObjectProperty(ai,"caption.text"),likes:ai.likes.count,comments:ai.comments.count,location:this._getObjectProperty(ai,"location.name")}),ak+=am}W.innerHTML=ak,ah=[],Z=0,ad=W.childNodes.length;while(Z<ad){ah.push(W.childNodes[Z]),Z+=1}for(J=0,Y=ah.length;J<Y;J++){H=ah[J],R.appendChild(H)}}else{for(j=0,ag=ae.length;j<ag;j++){ai=ae[j],aj=document.createElement("img"),ab=ai.images[this.options.resolution];if(typeof ab!="object"){throw ac="No image found for resolution: "+this.options.resolution+".",new Error(ac)}Q=ab.url,af=window.location.protocol.indexOf("http")>=0,af&&!this.options.useHttp&&(Q=Q.replace(/https?:\/\//,"//")),aj.src=Q,this.options.links===!0?(V=document.createElement("a"),V.href=ai.link,V.appendChild(aj),R.appendChild(V)):R.appendChild(aj)}}aq=this.options.target,typeof aq=="string"&&(aq=document.getElementById(aq));if(aq==null){throw ac='No element with id="'+this.options.target+'" on page.',new Error(ac)}aq.appendChild(R),ap=document.getElementsByTagName("head")[0],ap.removeChild(document.getElementById("instafeed-fetcher")),q="instafeedCache"+this.unique,window[q]=void 0;try{delete window[q]}catch(z){X=z}}return this.options.after!=null&&typeof this.options.after=="function"&&this.options.after.call(this),!0},b.prototype._buildUrl=function(){var d,c,f;d="https://api.instagram.com/v1";switch(this.options.get){case"popular":c="media/popular";break;case"tagged":if(!this.options.tagName){throw new Error("No tag name specified. Use the 'tagName' option.")}c="tags/"+this.options.tagName+"/media/recent";break;case"location":if(!this.options.locationId){throw new Error("No location specified. Use the 'locationId' option.")}c="locations/"+this.options.locationId+"/media/recent";break;case"user":if(!this.options.userId){throw new Error("No user specified. Use the 'userId' option.")}c="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}return f=d+"/"+c,this.options.accessToken!=null?f+="?access_token="+this.options.accessToken:f+="?client_id="+this.options.clientId,this.options.limit!=null&&(f+="&count="+this.options.limit),f+="&callback=instafeedCache"+this.unique+".parse",f},b.prototype._genKey=function(){var c;return c=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},""+c()+c()+c()+c()},b.prototype._makeTemplate=function(h,d){var k,g,c,f,j;g=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,k=h;while(g.test(k)){f=k.match(g)[1],j=(c=this._getObjectProperty(d,f))!=null?c:"",k=k.replace(g,function(){return""+j})}return k},b.prototype._getObjectProperty=function(f,c){var g,d;c=c.replace(/\[(\w+)\]/g,".$1"),d=c.split(".");while(d.length){g=d.shift();if(!(f!=null&&g in f)){return null}f=f[g]}return f},b.prototype._sortBy=function(f,c,g){var d;return d=function(l,k){var h,j;return h=this._getObjectProperty(l,c),j=this._getObjectProperty(k,c),g?h>j?1:-1:h<j?1:-1},f.sort(d.bind(this)),f},b.prototype._filter=function(h,d){var k,g,c,f,j;k=[],g=function(i){if(d(i)){return k.push(i)}};for(c=0,j=h.length;c<j;c++){f=h[c],g(f)}return k},b}(),function(c,b){return typeof define=="function"&&define.amd?define([],b):typeof module=="object"&&module.exports?module.exports=b():c.Instafeed=b()}(this,function(){return a})}).call(this);